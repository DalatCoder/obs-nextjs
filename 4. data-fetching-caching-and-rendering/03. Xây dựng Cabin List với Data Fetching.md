## Xây dựng Cabin List với Data Fetching

### Khái niệm chính

Bài học này hướng dẫn cách fetch (tải) dữ liệu từ database trong [[Next.js]] và hiển thị danh sách cabin sử dụng [[Server Components]]. Thay vì sử dụng state và useEffect như trong React truyền thống, chúng ta có thể fetch data trực tiếp trong component bằng async/await.

### Cách fetch data trong Server Components

**Bước 1: Chuyển component thành async function**

Thêm từ khóa `async` vào function component để có thể sử dụng `await`:

```javascript
export default async function Page() {
  console.log("Starting");
  
  const cabins = await getCabins();
  console.log(cabins);
  
  return (
    // JSX code
  );
}
```

**Đặc điểm quan trọng:**

- Component sẽ tạm dừng tại dòng `await` cho đến khi dữ liệu được tải xong
- Không cần `useEffect` hay state để lưu trữ dữ liệu
- Không cần thư viện fetch data bên ngoài
- Tất cả diễn ra trên server, HTML đã render sẽ được gửi đến browser


### Tối ưu hóa Images từ nguồn bên ngoài

**Vấn đề:** Khi sử dụng [[Next.js Image Component]] với URL từ nguồn external (như Supabase), cần cấu hình thêm.

**Giải pháp:**

**Cấu hình `next.config.js`**

Thêm hostname vào danh sách cho phép:

```javascript
module.exports = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'your-supabase-url.supabase.co',
        pathname: '/storage/v1/object/public/**',
      },
    ],
  },
}
```

### Ưu điểm của Server Components

- Gần với nguồn dữ liệu (data source), giảm độ trễ
- Trong nhiều trường hợp không cần API layer (với key-value storage)
- Code đơn giản, dễ đọc hơn so với pattern truyền thống
- [[Server-side rendering]] tự động, SEO tốt hơn


### Ghi chú thêm

**Về API layer:**

Trong ví dụ này, vẫn có API layer ẩn từ Supabase. Nếu sử dụng các giải pháp khác như key-value storage, có thể đọc dữ liệu trực tiếp mà không cần qua API.

**Kiểm tra rendering:**

Kiểm tra "View Source" trong browser để xác nhận HTML đã được render trên server và gửi đến client trong lần load đầu tiên.

***

**Liên kết:** [[Next.js]], [[Server Components]], [[Image Component]], [[Link Component]], [[async/await]], [[Server-side rendering]], [[Client-side navigation]], [[Supabase]], [[Data Fetching]]

