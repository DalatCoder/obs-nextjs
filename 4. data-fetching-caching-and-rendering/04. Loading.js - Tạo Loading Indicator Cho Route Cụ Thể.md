## Loading.js - Tạo Loading Indicator Cho Route Cụ Thể

### Khái niệm

File `loading.js` là một convention file (tệp quy ước) trong Next.js cho phép hiển thị trạng thái loading khi người dùng điều hướng đến một route. Next.js hỗ trợ tạo loading indicator ở nhiều cấp độ:

- **Loading toàn cục**: File `loading.js` ở thư mục gốc áp dụng cho tất cả routes
- **Loading cụ thể**: File `loading.js` trong thư mục route con chỉ áp dụng cho route đó và các sub-routes


### Triển khai Loading Spinner

Thay vì hiển thị text "loading data" đơn giản, có thể sử dụng component Spinner để tạo trải nghiệm tốt hơn:

```javascript
// app/loading.js (global)
import Spinner from '@/components/Spinner';

export default function Loading() {
  return <Spinner />;
}
```


### Tạo Loading Indicator Cho Route Cụ Thể

Để có loading indicator riêng cho route `/cabins`, tạo file `loading.js` trong thư mục `cabins`:

```javascript
// app/cabins/loading.js
import Spinner from '@/components/Spinner';

export default function Loading() {
  return (
    <div className="grid items-center justify-center">
      <Spinner />
      <p className="text-xl text-primary-200">
        Loading cabin data
      </p>
    </div>
  );
}
```

**Cách hoạt động của hierarchy (hệ thống phân cấp)**:

- File `loading.js` gần route nhất sẽ được ưu tiên hiển thị
- Route `/cabins` → hiển thị `app/cabins/loading.js`
- Route `/account/profile` → hiển thị `app/loading.js` (global) vì không có loading.js riêng


### Streaming và JavaScript Requirement

Khi sử dụng `loading.js`, Next.js tự động kích hoạt streaming (luồng dữ liệu):

- **Streaming được bật**: Nội dung được gửi từng phần đến client khi sẵn sàng
- **Yêu cầu JavaScript**: Website cần JavaScript được bật trong trình duyệt để hoạt động
- **Kiểm tra**: Tắt JavaScript trong DevTools (Command/Ctrl + Shift + P → "Disable JavaScript") sẽ làm trang không hoạt động


### Hạn chế của Loading.js

Khi sử dụng `loading.js`, toàn bộ nội dung của page sẽ bị ẩn trong thời gian loading, kể cả những phần không liên quan đến data fetching:

**Ví dụ**: Trang có cấu trúc:

- Heading và text tĩnh (không cần fetch data)
- Danh sách cabins (cần fetch từ Supabase API)

→ Cả heading và danh sách đều bị ẩn khi loading, mặc dù heading có thể hiển thị ngay

### Giải pháp: Suspense

Để có kiểm soát chi tiết hơn (granular control) về vị trí hiển thị loading indicator, cần sử dụng [[Suspense]] - một tính năng của React cho phép:

- Chỉ hiển thị loading cho phần đang fetch data
- Các phần khác của page vẫn render bình thường
- Tối ưu trải nghiệm người dùng

**Liên kết:** [[Loading.js]], [[Streaming]], [[Suspense]], [[Next.js Convention Files]], [[Data Fetching]]

