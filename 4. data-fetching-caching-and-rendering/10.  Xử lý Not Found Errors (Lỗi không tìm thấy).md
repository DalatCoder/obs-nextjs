## Xử lý Not Found Errors (Lỗi không tìm thấy)

### Giới thiệu

Sau khi thiết lập global error boundary, cần xử lý riêng **Not Found errors** (lỗi 404) - một loại lỗi phổ biến khi người dùng truy cập route không tồn tại hoặc ID không hợp lệ. Next.js cho phép tùy chỉnh trang 404 thay vì hiển thị error page mặc định.

### Tạo Custom Not Found Page

#### Convention file: not-found.js

Tạo file `not-found.js` trong root app folder:

```javascript
// app/not-found.js
import Link from 'next/link';

export default function NotFound() {
  return (
    <div className="text-center">
      <h1>This page could not be found</h1>
      <Link href="/" className="button">
        Go back home
      </Link>
    </div>
  );
}
```

Khi người dùng truy cập route không tồn tại (ví dụ: `/random-page`), Next.js tự động hiển thị component này thay vì 404 page mặc định.

### Hai cách hiển thị Not Found Page

#### Cách 1: Automatic (Tự động)

Next.js tự động hiển thị not-found page khi URL không match với bất kỳ route nào đã định nghĩa. Không cần code thêm, chỉ cần có file `not-found.js`.

#### Cách 2: Manual Trigger (Kích hoạt thủ công)

Sử dụng function `notFound()` từ Next.js để manually trigger not-found page trong các tình huống cụ thể:

```javascript
// app/cabins/[cabinId]/page.js
import { notFound } from 'next/navigation';

export default async function Page({ params }) {
  const cabin = await getCabin(params.cabinId);
  
  // Nếu cabin không tồn tại, trigger not-found page
  if (!cabin) {
    notFound();
  }
  
  return <div>{/* render cabin */}</div>;
}
```


### Use Case: Invalid Cabin ID

Khi người dùng truy cập `/cabins/999` với ID không tồn tại:

```javascript
// data-service.js
export async function getCabin(id) {
  const { data, error } = await supabase
    .from('cabins')
    .select('*')
    .eq('id', id)
    .single();
  
  if (error) {
    console.error(error);
    notFound(); // Trigger not-found page thay vì throw error
  }
  
  return data;
}
```

**Lợi ích:** Thay vì hiển thị error boundary generic, người dùng thấy thông báo rõ ràng "page not found" - phù hợp hơn với tình huống ID không tồn tại.

### Nested Not Found Pages

Tương tự như `error.js` và `loading.js`, có thể tạo `not-found.js` specific cho từng route segment:

```
app/
  not-found.js           (Global 404 page)
  cabins/
    [cabinId]/
      not-found.js       (Custom 404 cho cabins)
      page.js
```


#### Ví dụ: Custom Not Found cho Cabins

```javascript
// app/cabins/[cabinId]/not-found.js
import Link from 'next/link';

export default function NotFound() {
  return (
    <div>
      <h1>This cabin could not be found</h1>
      <Link href="/cabins">
        Back to all cabins
      </Link>
    </div>
  );
}
```

**Kết quả:** Khi gọi `notFound()` trong cabin page, hiển thị message cụ thể "This cabin could not be found" thay vì message generic, và link back về `/cabins` thay vì homepage.

### Import notFound Function

```javascript
import { notFound } from 'next/navigation';
```

**Lưu ý:** Import từ `next/navigation`, **không phải** `next/link` hay `next`.

### Khi nào sử dụng notFound()

**Invalid IDs:** Khi fetch dữ liệu theo ID và không tìm thấy record.

**Unauthorized access:** Khi user không có quyền truy cập resource (tùy logic business).

**Deleted content:** Khi nội dung đã bị xóa nhưng URL vẫn tồn tại.

**Query không trả về kết quả:** Khi search hoặc filter không có kết quả phù hợp.

### So sánh với Error Boundary

**Not Found:**

- Cho tình huống resource không tồn tại
- HTTP status 404
- Thân thiện với user hơn
- Rõ ràng về nguyên nhân

**Error Boundary:**

- Cho unexpected errors, bugs
- HTTP status 500
- Thông báo generic "something went wrong"
- Có thể technical hơn


### Best Practices

**Thông báo rõ ràng:** Message nên chỉ rõ resource nào không tìm thấy (cabin, post, user, etc.).

**Navigation options:** Luôn cung cấp link để user quay lại trang hợp lệ.

**Styling nhất quán:** Not found page nên match với design system của app.

**Logging:** Trong production, cân nhắc log not-found cases để phát hiện broken links hoặc invalid IDs.

### Cấu trúc hoàn chỉnh

```javascript
// app/cabins/[cabinId]/page.js
import { notFound } from 'next/navigation';
import { getCabin } from '@/data-service';

export default async function Page({ params }) {
  let cabin;
  
  try {
    cabin = await getCabin(params.cabinId);
  } catch (error) {
    console.error('Error fetching cabin:', error);
    notFound();
  }
  
  if (!cabin) {
    notFound();
  }
  
  return (
    <div>
      <h1>{cabin.name}</h1>
      {/* render cabin details */}
    </div>
  );
}
```


### Ghi chú thêm

- `notFound()` là function, không phải component - phải được gọi như `notFound()` chứ không phải `<NotFound />`
- Có thể gọi trong server components, API routes, hoặc server actions
- Next.js tự động set HTTP status code 404 khi not-found page được hiển thị
- Nested not-found pages cho phép tùy chỉnh message và navigation cho từng section của app

**Liên kết:** [[Next.js]], [[Not Found]], [[Error Handling]], [[404 Error]], [[notFound Function]], [[Convention Files]], [[Nested Routes]], [[Data Fetching]], [[Invalid IDs]]

