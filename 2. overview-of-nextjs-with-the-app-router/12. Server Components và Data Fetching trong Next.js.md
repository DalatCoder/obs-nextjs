## Server Components và Data Fetching trong Next.js

### Khái niệm cơ bản

Trong Next.js với React Server Components (RSC), mỗi page (trang) mặc định là một server component và **bắt buộc phải** là server component. Điều này cho phép fetch (lấy) dữ liệu trực tiếp ngay trong React component - một khả năng mà trước đây chưa từng có.

Không chỉ pages, các component khác như navigation component cũng mặc định là server components và được render (hiển thị) hoàn toàn trên server.

### Cách fetch dữ liệu trong Server Component

Để fetch dữ liệu trực tiếp trong component, ta có thể sử dụng hàm `fetch` tiêu chuẩn với cú pháp `async/await`:

```javascript
export default async function CabinsPage() {
  const res = await fetch('https://jsonplaceholder.typicode.com/users');
  const data = await res.json();
  
  console.log(data);
  
  return (
    <ul>
      {data.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

**Điểm đặc biệt:** Component được khai báo là `async function` - điều này trước đây không thể làm với React component thông thường.

### Đặc điểm của Server Components

- **Console logs xuất hiện ở terminal server**, không phải browser console. Điều này chứng tỏ code đang chạy trên server
- **Dữ liệu được render thành HTML** ngay trên server trước khi gửi đến browser
- Khi xem "View Page Source", có thể thấy dữ liệu đã có sẵn trong HTML
- Trong Network tab, không thấy request fetch dữ liệu từ client


### Cơ chế Caching

Khi navigate (điều hướng) giữa các trang:

- Lần đầu tiên truy cập trang: cần thời gian để fetch dữ liệu trên server, sau đó mới render HTML và gửi về browser
- Những lần tiếp theo: dữ liệu được cache trong Next.js cache của browser, trang load gần như tức thì
- Reload trang hoàn toàn: dữ liệu cần được fetch lại từ server


### Ưu điểm của Server Components

Server Components cho phép thực hiện data fetching và rendering HTML hoàn toàn trên server, đồng thời vẫn sử dụng cú pháp React components quen thuộc. Đây là sự kết hợp mạnh mẽ giữa khả năng server-side rendering và trải nghiệm phát triển của React.

**Liên kết:** [[Server Components]], [[Data Fetching]], [[Next.js Cache]], [[SSR]], [[React Server Components]], [[Async Components]]

