## Server-Side Rendering: Khái niệm và So sánh

### Bối cảnh lịch sử

#### Giai đoạn truyền thống

Trong quá khứ với PHP và WordPress, các website luôn được render (kết xuất) trên server và gửi đến trình duyệt. Tuy nhiên, khi ứng dụng web cần trở nên động và tương tác hơn, quá trình render đã chuyển từ server sang client.

#### Kỷ nguyên hiện đại

Sự chuyển dịch này đã tạo ra nhiều framework và thư viện như Angular, Svelte, Vue và [[React]]. Hiện nay, chúng ta đang chứng kiến xu hướng quay trở lại [[Server-Side Rendering]] cho một số loại ứng dụng cụ thể.

#### Xu hướng mới

Các [[Full-Stack Framework]] như [[Next.js]], Remix, Nuxt, SvelteKit hay SolidStart đang thúc đẩy xu hướng này. Chúng khác biệt hoàn toàn với PHP hay WordPress truyền thống vì kết hợp cả [[Server-Side Rendering]] và [[Client-Side Rendering]], tận dụng điểm mạnh của cả hai phương pháp.

### So sánh Client-Side vs Server-Side Rendering

#### Client-Side Rendering (CSR)

**Cách hoạt động:**

- HTML markup được render trên client (máy tính người dùng) bằng JavaScript
- Trang web được tạo ra trực tiếp trên thiết bị của người dùng
- Đây là cách chúng ta đã sử dụng trong suốt khóa học với [[React]]

**Nhược điểm:**

- Tải trang ban đầu chậm do JavaScript bundle có thể khá lớn và phải được tải hoàn toàn trước
- Tồn tại hiện tượng request waterfall (thác nước yêu cầu): dữ liệu chỉ bắt đầu được fetch sau khi components đã được mount
- Tốc độ trải nghiệm chậm hơn trong lần tải đầu tiên

**Ưu điểm:**

- Trải nghiệm người dùng rất tương tác sau khi tải xong
- Tạo cảm giác [[Single Page Application]] mượt mà
- Toàn bộ app đã được tải xuống (trừ dữ liệu mới), giúp điều hướng nhanh


#### Server-Side Rendering (SSR)

**Cách hoạt động:**

- HTML được tạo sẵn trên web server
- Server gửi website đã được render đến client khi có yêu cầu
- Công việc render chuyển từ máy người dùng sang máy chủ do developer kiểm soát

**Ưu điểm:**

- Tải trang ban đầu nhanh hơn nhiều vì hai lý do:
    - JavaScript cần tải ít hơn (client không cần JavaScript để render HTML)
    - Dữ liệu được tải trên server trước khi HTML được tạo và tích hợp sẵn vào trang
- [[SEO]] (Search Engine Optimization) tốt hơn: nội dung được tạo sẵn dễ dàng cho công cụ tìm kiếm index
- Phù hợp cho các website hướng nội dung (content-driven)

**Nhược điểm:**

- Tính tương tác thấp hơn ban đầu
- Điều hướng giữa các trang có thể yêu cầu server render trang mới, dẫn đến full page reload

**Lưu ý:** Các framework hiện đại như [[Next.js]] đang làm mờ ranh giới này bằng cách cho phép các trang được render trên server sau đó hydrate (thủy hóa) trên client để trở nên tương tác.

### SEO và lựa chọn phương pháp render

#### Khi nào dùng Server-Side Rendering

Phù hợp cho các website/ứng dụng chủ yếu về nội dung:

- Nền tảng thương mại điện tử (e-commerce)
- Blog và trang tin tức
- Website marketing
- Các trang web cần [[SEO]] quan trọng để thu hút người dùng


#### Khi nào dùng Client-Side Rendering

Phù hợp cho:

- [[Single Page Application]] có tính tương tác cao
- Ứng dụng không cần [[SEO]] (ví dụ: The Wild Oasis app - công cụ nội bộ công ty)
- Ứng dụng yêu cầu đăng nhập, không công khai


### Hai loại Server-Side Rendering

#### Static Rendering (Static Site Generation)

- HTML được tạo tại thời điểm build (build time)
- Developer export thành các file HTML, CSS, JavaScript tĩnh
- Các file này được deploy lên web server
- Server không regenerate markup mỗi lần, chỉ gửi những gì đã được tạo ban đầu


#### Dynamic Rendering

- Server thực sự tạo HTML mới mỗi khi có request
- Tạo trang mới cho mỗi người dùng
- Phù hợp khi dữ liệu thay đổi thường xuyên
- Một số developer coi đây là [[Server-Side Rendering]] thực sự


### Timeline so sánh CSR và SSR

#### Client-Side Rendering Timeline

1. User yêu cầu trang → Server gửi trang rỗng với CSS và JavaScript bundle (có thể nặng)
2. JavaScript bundle được tải xuống và thực thi
3. App phát hiện cần fetch data → Hiển thị spinner
4. Fetch data từ server (có thể là API endpoint khác)
5. Data đến → App re-render với data mới
6. **Largest Contentful Paint (LCP)** - trang hiển thị đầy đủ nội dung cho user

#### Server-Side Rendering Timeline

1. User yêu cầu trang → Server fetch toàn bộ data cần thiết
2. Server tạo trang hoàn chỉnh với data
3. Gửi sản phẩm hoàn thiện đến client
4. **Largest Contentful Paint (LCP)** - trang có sẵn nội dung ngay lập tức (nhanh hơn CSR nhiều)
5. JavaScript bundle được tải xuống và thực thi
6. Quá trình [[Hydration]] diễn ra - HTML tĩnh trở nên tương tác

### Ba điểm chính về SSR

- Server khởi tạo việc fetch data trước khi trang được render
- Quá trình render chuyển từ client sang server
- [[Largest Contentful Paint]] xảy ra sớm hơn nhiều so với [[Client-Side Rendering]]


### Hydration là gì?

[[Hydration]] (thủy hóa) là quá trình HTML tĩnh trở nên tương tác bằng cách thêm JavaScript vào. Website được gửi đến client trong [[Server-Side Rendering]] vẫn bao gồm JavaScript bundle, sau khi được tải và thực thi, hydration sẽ xảy ra để làm cho trang có thể tương tác.

**Liên kết:** [[Server-Side Rendering]], [[Client-Side Rendering]], [[Next.js]], [[Single Page Application]], [[SEO]], [[Hydration]], [[Largest Contentful Paint]], [[Static Rendering]], [[Dynamic Rendering]], [[Full-Stack Framework]], [[React]]

