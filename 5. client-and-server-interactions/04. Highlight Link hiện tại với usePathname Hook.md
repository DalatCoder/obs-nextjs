## Highlight Link hiện tại với usePathname Hook

### Giới thiệu

Bài học này hướng dẫn cách sử dụng hook `usePathname` do NextJS cung cấp để làm nổi bật (highlight) link hiện tại trong site navigation, đồng thời khám phá component tree thông qua React Developer Tools.

### Phân tích Component Tree trong React DevTools

#### Cấu trúc component tree

Khi kiểm tra component tree trong [[React Developer Tools]], có thể quan sát:

- Nhiều component được cung cấp bởi NextJS: ErrorBoundary, NotFoundBoundary
- Các boundary này được tạo tự động từ `error.js` và `loading.js`
- **Không thấy tên các Server Components** mà chúng ta tạo (như Page, CabinList) vì chúng đã được render trên server
- Component tree chỉ hiển thị phần client được render trên client


#### Hydration trong component tree

Các Client Component như TextExpander hiển thị thông tin:

- Tên component chính xác mà chúng ta đặt
- Được render bởi `hydrateRoot` - cho thấy component đã được:
    - Render trên server trước
    - Hydrated trên client sau đó
- Điều này khác với ứng dụng React thuần túy chỉ hiển thị "rendered by React"


#### Suspense Boundary

Có thể thao tác với [[Suspense]] boundary trong DevTools:

- Tìm thấy suspense boundary trong component tree
- Manually set giá trị thành `true` để xem loading spinner
- Set về `false` để content hiển thị trở lại
- Tính năng này hữu ích để test các trạng thái loading


### Triển khai Active Link Highlighting

#### Yêu cầu chức năng

Làm nổi bật link hiện tại trong navigation:

- Khi ở trang Home → highlight link Home
- Khi ở trang Cabins → highlight link Cabins
- Khi ở trang Account → highlight link Account


#### Hook usePathname

NextJS cung cấp custom hook `usePathname` để lấy URL hiện tại:

```jsx
import { usePathname } from 'next/navigation'

function Navigation() {
  const pathname = usePathname()
  console.log(pathname) // Ví dụ: /account/reservations
  
  return (
    // Navigation JSX
  )
}
```


#### Lỗi khi sử dụng trong Server Component

Khi sử dụng `usePathname` trong Server Component sẽ gặp lỗi:

```
usePathname only works in client components
```

**Giải pháp**: Thêm directive `'use client'` để chuyển thành Client Component:

```jsx
'use client'

import { usePathname } from 'next/navigation'
```


### Code Implementation hoàn chỉnh

#### Cấu trúc navigation links

```jsx
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/cabins', label: 'Cabins' },
  { href: '/account', label: 'Account' }
]
```


#### Component với conditional styling

```jsx
'use client'

import { usePathname } from 'next/navigation'

function Navigation() {
  const pathname = usePathname()
  
  return (
    <nav>
      {navLinks.map((link) => (
        <a
          key={link.href}
          href={link.href}
          className={`nav-link ${
            pathname === link.href 
              ? 'bg-primary-900' // Highlighted style
              : '' // Default style
          }`}
        >
          {link.label}
        </a>
      ))}
    </nav>
  )
}
```


#### Giải thích logic

- Sử dụng `pathname` từ `usePathname()` hook
- Loop qua array `navLinks` để render các link
- So sánh `pathname` với `link.href` của từng link
- Nếu khớp: thêm class `bg-primary-900` (màu nền sáng hơn)
- Nếu không khớp: không thêm style bổ sung
- Sử dụng [[Template Literals]] để conditional styling trong className


### Khi nào cần Client Component

#### Trường hợp bắt buộc

Có những trường hợp **bắt buộc** phải chuyển sang Client Component ngay cả khi tính năng không có vẻ "dynamic":

- Cần sử dụng React hooks (useState, useEffect, custom hooks...)
- Cần sử dụng hooks của NextJS như usePathname, useSearchParams, useRouter
- Cần xử lý browser APIs (window, document, localStorage...)
- Cần event handlers (onClick, onChange, onSubmit...)


#### Trường hợp usePathname

Mặc dù highlighting active link không có vẻ là tính năng rất dynamic, nhưng:

- NextJS yêu cầu sử dụng hook `usePathname` để lấy current path
- Hooks chỉ hoạt động trong Client Components
- Do đó phải chuyển navigation component thành Client Component


### Kiểm tra trong DevTools

Sau khi implement, có thể kiểm tra trong React DevTools:

- Tìm Navigation component trong component tree
- Xác nhận component hiển thị với tên chính xác
- Quan sát props và state của component
- Kiểm tra styling conditional được áp dụng đúng


### Best Practices

#### Tối ưu Client Components

- Chỉ chuyển sang Client Component khi thực sự cần thiết
- Giữ Client Components nhỏ gọn và tập trung vào chức năng cụ thể
- Navigation component là Client Component hợp lý vì cần hooks


#### Conditional Styling

- Sử dụng template literals cho conditional className
- Giữ logic styling đơn giản và dễ đọc
- Có thể tách logic phức tạp thành helper functions


### Ghi chú quan trọng

#### Hydration indicator

Khi thấy "rendered by hydrateRoot" trong DevTools, điều này xác nhận:

- Ứng dụng sử dụng server-side rendering
- Component được render trên server trước
- Component được hydrate với JavaScript trên client
- Đây là dấu hiệu của ứng dụng NextJS đang hoạt động đúng


#### React Hooks trong NextJS

NextJS mở rộng React với các custom hooks riêng:

- `usePathname` - lấy current pathname
- `useSearchParams` - làm việc với URL search params
- `useRouter` - điều hướng programmatic
- Tất cả đều chỉ hoạt động trong Client Components

**Liên kết:** [[usePathname]], [[Client Component]], [[React Hooks]], [[React Developer Tools]], [[Hydration]], [[Conditional Styling]], [[Template Literals]], [[Next Navigation]], [[Suspense]], [[Server-Side Rendering]]

