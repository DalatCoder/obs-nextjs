## Kết nối Supabase với ứng dụng React

### Cài đặt và khởi tạo Supabase Client

Quá trình kết nối Supabase với React diễn ra khá đơn giản nhờ tài liệu API có sẵn trong Supabase dashboard.

**Bước 1: Cài đặt thư viện**

Sử dụng npm để cài đặt JavaScript library:

```bash
npm install @supabase/supabase-js
```

**Bước 2: Tạo Supabase Client**

Trong thư mục services, tạo file mới để khởi tạo Supabase client. File này sẽ chứa cấu hình kết nối và xuất client để sử dụng ở các nơi khác trong ứng dụng:

```javascript
import { createClient } from '@supabase/supabase-js'

const supabaseUrl = 'YOUR_SUPABASE_URL'
const supabaseKey = 'YOUR_SUPABASE_ANON_KEY'

const supabase = createClient(supabaseUrl, supabaseKey)

export default supabase
```

**Lấy thông tin cấu hình:**

- Vào Project Settings → API
- Sao chép URL của project
- Sao chép anon key (public key)


### Bảo mật API Key trên Client

Một câu hỏi quan trọng: Liệu có an toàn khi để lộ API key trên client-side không?

**Câu trả lời:** Hoàn toàn an toàn nhờ [[Row-Level Security]].

Cơ chế bảo vệ:

- Anon key chỉ cho phép thực hiện các thao tác được định nghĩa trong [[RLS Policies]]
- Kể cả khi key bị đánh cắp, kẻ tấn công không thể làm gì ngoài những gì đã được cho phép
- Hiện tại chỉ cho phép đọc dữ liệu từ 4 bảng, không có quyền ghi hay xóa

Nếu không bật Row-Level Security, việc lộ key sẽ rất nguy hiểm vì người khác có thể:

- Xóa toàn bộ database
- Chỉnh sửa bất kỳ dữ liệu nào
- Thực hiện các thao tác không mong muốn


### Tạo API Service cho từng bảng

Tổ chức code theo pattern service layer, mỗi bảng có một file service riêng.

**Tạo file apiCabins.js:**

```javascript
import supabase from './supabase'

export async function getCabins() {
  const { data, error } = await supabase
    .from('cabins')
    .select('*')
  
  if (error) {
    console.error('Cabins could not be loaded')
    throw new Error(error.message)
  }
  
  return data
}
```

**Giải thích code:**

- Sử dụng supabase client đã khởi tạo trước đó
- Method `.from()` chỉ định tên bảng cần truy vấn
- Method `.select('*')` lấy tất cả các cột
- Xử lý lỗi bằng cách log ra console và throw error
- Trả về data nếu thành công


### Cấu trúc query với Supabase

Cú pháp query của Supabase rất trực quan:

```javascript
// Lấy tất cả cột
.select('*')

// Lấy cột cụ thể
.select('id, name, price')

// Có thể chain thêm các điều kiện
.select('*')
.eq('status', 'active')
.order('created_at', { ascending: false })
```


### Sử dụng trong React Component

**Thử nghiệm trong Page Component:**

```javascript
import { useEffect } from 'react'
import { getCabins } from '../services/apiCabins'

function CabinsPage() {
  useEffect(() => {
    getCabins().then(data => {
      console.log(data)
    })
  }, [])
  
  return <div>Cabins Page</div>
}
```

**Lưu ý:** Đây chỉ là thử nghiệm. Trong thực tế, không nên thực hiện side effects trực tiếp trong page components như vậy. Nên sử dụng các pattern quản lý state như:

- React Query
- Redux
- Context API với custom hooks


### Kết quả và ý nghĩa

Sau khi implement và reload trang, có thể thấy dữ liệu cabin được log ra console thành công. Đây là cabin đã tạo từ các video trước.

**Ý nghĩa của việc kết nối thành công:**

- Đã tạo được backend hoàn chỉnh
- Kết nối thành công backend với frontend
- Có thể xây dựng full-stack applications mà không cần setup server phức tạp
- Tận dụng được các tính năng mạnh mẽ của Supabase như real-time, authentication, storage


### Lợi ích của Supabase

Supabase giúp đơn giản hóa quá trình phát triển ứng dụng:

- Không cần viết backend API từ đầu
- Tự động tạo RESTful API cho mọi bảng
- Tích hợp sẵn authentication, authorization
- Hỗ trợ real-time subscriptions
- Có dashboard trực quan để quản lý dữ liệu
- Miễn phí cho các dự án nhỏ

Điều này cho phép developers tập trung vào logic nghiệp vụ và UI/UX thay vì phải lo lắng về infrastructure.

### Các bước tiếp theo

Sau khi đã kết nối thành công, có thể:

- Tạo các API functions cho các bảng khác (bookings, settings)
- Implement CRUD operations đầy đủ (Create, Read, Update, Delete)
- Tích hợp với state management library
- Xây dựng UI để hiển thị và thao tác dữ liệu
- Thêm authentication cho users
- Cấu hình RLS policies phức tạp hơn

***

**Liên kết:** [[Supabase]], [[React]], [[Supabase Client]], [[API Service]], [[Row-Level Security]], [[Full-Stack Development]], [[CRUD Operations]], [[useEffect]], [[Async/Await]]

