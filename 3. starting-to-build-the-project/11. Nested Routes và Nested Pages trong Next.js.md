## Nested Routes và Nested Pages trong Next.js

### Xây Dựng Phần Account Section

Phần guest area của website sẽ có cấu trúc URL như sau:

- `/account` - trang dashboard chính
- `/account/reservations` - trang quản lý đặt phòng
- `/account/profile` - trang hồ sơ cá nhân

Next.js gọi mỗi phần của URL này là một **segment** (phân đoạn). Cấu trúc URL được xây dựng dựa trên hệ thống folder (file tree).

### Cấu Trúc Folder System

**Mapping giữa URL và folder:**

```
app/                    → /
  account/             → /account
    page.js            → trang account chính
    reservations/      → /account/reservations
      page.js          → trang reservations
    profile/           → /account/profile
      page.js          → trang profile
```

Folder `app` global tương ứng với root URL, folder `account` tạo segment `/account`, và các nested folders tạo các nested routes (routes lồng nhau).

### Tạo Nested Routes

**Bước 1: Tạo nested folders**

Trong folder `account`, tạo hai folder con:

- `reservations`
- `profile`

**Bước 2: Thêm page.js vào mỗi folder**

Mỗi folder cần file `page.js` để trở thành routable (có thể định tuyến). Nếu không có `page.js`, truy cập URL sẽ báo lỗi "page not found".

**Ví dụ: account/page.js**

```javascript
export default function Account() {
  return (
    <div>
      <h2>Welcome Jonas</h2>
      {/* Nội dung dashboard */}
    </div>
  )
}
```

**Ví dụ: account/reservations/page.js**

```javascript
import ReservationCard from '@/app/_components/ReservationCard'

export default function Reservations() {
  const bookings = [] // Dữ liệu mặc định trống
  
  return (
    <div>
      <h2>Your reservations</h2>
      {bookings.length === 0 ? (
        <p>No reservations yet</p>
      ) : (
        bookings.map(booking => (
          <ReservationCard key={booking.id} booking={booking} />
        ))
      )}
    </div>
  )
}
```


### Import Components Cần Thiết

**ReservationCard Component:**

Component này cần các dependencies:

- `date-fns` package để xử lý ngày tháng
- `DeleteReservation` component để xóa đặt phòng

**Cài đặt date-fns:**

```bash
npm install date-fns
```

**Import trong ReservationCard:**

```javascript
import { format } from 'date-fns'
import DeleteReservation from '@/app/_components/DeleteReservation'
```


### Profile Page Setup

**account/profile/page.js**

```javascript
import SelectCountry from '@/app/_components/SelectCountry'

export default function Profile() {
  return (
    <div>
      <h2>Update your guest profile</h2>
      <form>
        {/* Form fields */}
        <SelectCountry />
        {/* Các input khác */}
      </form>
    </div>
  )
}
```

Component `SelectCountry` cho phép người dùng chọn quốc gia trong form hồ sơ.

### Starter Files và Copy-Paste

Các starter files chứa:

- Markup HTML với styling
- Một số logic JavaScript cơ bản
- Không bao gồm phần Next.js quan trọng như data fetching

**Lý do sử dụng starter files:**

- Tập trung vào các khái niệm Next.js quan trọng
- Tiết kiệm thời gian viết code aesthetic (thẩm mỹ)
- Tránh lan man vào chi tiết styling không cần thiết


### Vấn Đề Navigation

Sau khi setup nested routes, cần có cách điều hướng giữa các trang. Hiện tại không có navigation links trong phần guest area.

**Giải pháp:** Tạo nested navigation (điều hướng lồng nhau) ở sidebar bên trái với các links:

- Home (`/account`)
- Reservations (`/account/reservations`)
- Profile (`/account/profile`)

Nested layout sẽ được thiết lập trong lecture tiếp theo để hiển thị navigation này.

### File System Based Routing

**Ưu điểm của Next.js routing:**

- Tạo routes bằng cách tạo folders - đơn giản và trực quan
- Cấu trúc URL phản ánh chính xác cấu trúc folder
- Không cần config routing phức tạp như các frameworks khác
- Dễ hiểu và maintain (bảo trì)

**Convention quan trọng:**

- Mỗi routable folder phải có file `page.js`
- Tên file phải chính xác là `page.js` (không phải `Page.js` hay `page.jsx`)
- Nested folders tự động tạo nested routes


### Dummy Data và Dynamic Content

Hiện tại sử dụng dummy data (dữ liệu giả):

- `bookings = []` - mảng rỗng cho reservations
- `"Welcome Jonas"` - username cố định

**Sau này sẽ thay thế bằng:**

- Real data từ database
- Dynamic username từ authentication
- Actual bookings của user


### Error Handling

**Lỗi thường gặp:**

1. **"Page not found"** - Chưa có `page.js` trong folder
2. **Component import errors** - Chưa import hoặc sai đường dẫn
3. **Package not installed** - Chưa cài đặt dependencies như `date-fns`

**Debug tips:**

- Kiểm tra tên file phải là `page.js`
- Verify import paths sử dụng alias `@/app/`
- Đảm bảo đã cài đặt tất cả packages cần thiết


### Component Organization

**Folder _components:**

Components được đặt trong folder `_components` với dấu gạch dưới prefix để:

- Phân biệt với route folders
- Tổ chức code rõ ràng
- Next.js hiểu đây không phải là route segment

**Import pattern:**

```javascript
import Component from '@/app/_components/Component'
```


### Ghi Chú Thêm

- Nested routing trong Next.js rất linh hoạt, có thể tạo routes sâu nhiều cấp
- File system based routing giúp code dễ đọc và dễ navigate
- Starter files giúp tiết kiệm thời gian nhưng cần hiểu cấu trúc để customize
- Username và data sẽ dynamic hóa sau khi implement authentication
- Nested layout cho navigation sẽ được setup ở lecture tiếp theo

**Liên kết:** [[Next.js]], [[Nested Routes]], [[File System Routing]], [[Page.js]], [[Route Segments]], [[Nested Layouts]], [[Dynamic Routes]], [[Component Organization]], [[date-fns]], [[Guest Area]], [[Authentication]], [[Navigation]], [[Layout]], [[Folder Structure]]

