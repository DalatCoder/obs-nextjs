## Metadata Trong Next.js

### Khái Niệm Metadata

**Metadata** là thông tin mô tả về trang web, bao gồm title, description, và các meta tags khác. Trong Next.js, metadata được quản lý thông qua một API tích hợp sẵn thay vì phải thêm thủ công vào HTML head.

**Quy tắc quan trọng:**

```
- Không thêm trực tiếp các thẻ `<title>`, `<meta>` vào HTML head
```

- Sử dụng đối tượng `metadata` được export từ layout hoặc page
- Next.js tự động xử lý và thêm vào HTML head


### Export Metadata Từ Layout

**Metadata toàn cục:** Export từ root layout để áp dụng cho tất cả các trang.

```javascript
// app/layout.js
export const metadata = {
  title: 'The Wild Oasis'
}

export default function RootLayout({ children }) {
  return (
    <html>
      <body>{children}</body>
    </html>
  )
}
```

**Kết quả:**

- Title "The Wild Oasis" xuất hiện trên tất cả các trang
- Hiển thị trong tab trình duyệt
- Được thêm vào thẻ `<title>` trong HTML head


### Override Metadata Từ Page

**Metadata cụ thể cho từng trang:** Export từ file `page.js` để ghi đè metadata của layout.

```javascript
// app/cabins/page.js
export const metadata = {
  title: 'Cabins'
}

export default function CabinsPage() {
  return <div>Cabins content</div>
}
```

**Cơ chế hoạt động:**

- Metadata từ page có độ ưu tiên cao hơn layout
- Chỉ override các thuộc tính được định nghĩa lại
- Các thuộc tính khác vẫn kế thừa từ layout cha


### Template Title Nâng Cao

**Vấn đề:** Muốn giữ tên thương hiệu trong tất cả các title nhưng thêm tiền tố khác nhau cho mỗi trang.

**Ví dụ mong muốn:**

- Trang About: "About / The Wild Oasis"
- Trang Cabins: "Cabins / The Wild Oasis"
- Trang Home: "Welcome / The Wild Oasis"

**Giải pháp với template:**

```javascript
// app/layout.js
export const metadata = {
  title: {
    template: '%s / The Wild Oasis',
    default: 'Welcome / The Wild Oasis'
  }
}
```

**Giải thích cấu trúc:**

- `template`: Mẫu title với `%s` là placeholder
- `%s` sẽ được thay thế bằng title từ page cụ thể
- `default`: Giá trị mặc định khi page không export title
- Có thể thêm bất kỳ ký tự nào vào template (như `/`, `|`, `-`)

**Ví dụ cụ thể:**

```javascript
// app/about/page.js
export const metadata = {
  title: 'About'
}
// Kết quả: "About / The Wild Oasis"

// app/cabins/page.js
export const metadata = {
  title: 'Cabins'
}
// Kết quả: "Cabins / The Wild Oasis"

// app/page.js (không export metadata)
// Kết quả: "Welcome / The Wild Oasis" (dùng default)
```


### Description Cho SEO

**Tầm quan trọng:** Description là yếu tố quan trọng cho tối ưu hóa công cụ tìm kiếm (SEO - Search Engine Optimization).

**Thêm description:**

```javascript
// app/layout.js
export const metadata = {
  title: {
    template: '%s / The Wild Oasis',
    default: 'Welcome / The Wild Oasis'
  },
  description: 'Luxurious cabin hotel located in the heart of the Italian Dolomites, surrounded by beautiful mountains and dark forests'
}
```

**Kết quả trong HTML:**

```html
<head>
  <title>Welcome / The Wild Oasis</title>
  <meta name="description" content="Luxurious cabin hotel located in the heart of the Italian Dolomites, surrounded by beautiful mountains and dark forests">
</head>
```

**Override description:**

- Tương tự title, có thể override description từng trang
- Export description mới từ page để ghi đè
- Nếu không export, dùng description từ layout cha

```javascript
// app/cabins/page.js
export const metadata = {
  title: 'Cabins',
  description: 'Browse our collection of luxury cabins'
}
```


### Favicon Configuration

**Khái niệm:** Favicon là icon nhỏ hiển thị trên tab trình duyệt, bookmarks và shortcuts.

**Cách truyền thống (phức tạp):**

- Tạo nhiều kích thước icon khác nhau
- Thêm nhiều thẻ `<link>` vào HTML head
- Cấu hình cho nhiều thiết bị và platform

**Cách Next.js (đơn giản):**

Chỉ cần đặt file icon vào thư mục `app` với tên đúng convention:

```
app/
  icon.png          ✓ Hoặc
  icon.ico          ✓ Hoặc  
  icon.jpg          ✓ Hoặc
  icon.svg          ✓
  layout.js
  page.js
```

**Yêu cầu:**

- Tên file phải là `icon`
- Có thể dùng bất kỳ định dạng ảnh: .png, .ico, .jpg, .svg
- Nên dùng .png với background trong suốt
- Next.js tự động xử lý sizing và optimization

**Ví dụ thực tế:**

```
app/
  icon.png          ← File logo với background trong suốt
  layout.js
  page.js
```

Next.js tự động:

- Tạo các thẻ `<link rel="icon">` cần thiết
- Tối ưu kích thước icon
- Hỗ trợ nhiều thiết bị và trình duyệt


### Bug Và Lưu Ý

**Title flicker khi loading:**

- Có thể thấy title nhấp nháy khi chuyển trang
- Title tạm thời hiển thị "localhost:3000"
- Đây là bug của Next.js (tính đến thời điểm hiện tại)
- Chưa có cách fix chính thức, có thể được sửa trong tương lai

**Caching behavior:**

- Sau lần load đầu tiên, metadata được cache
- Reload trang có thể thấy title flicker rõ hơn
- Không ảnh hưởng đến production build


### So Sánh Với Cách Truyền Thống

**Truyền thống (không khuyến khích):**

```javascript
export default function Page() {
  return (
    <>
      <Head>
        <title>Page Title</title>
        <meta name="description" content="Description" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div>Content</div>
    </>
  )
}
```

**Next.js modern way (khuyến khích):**

```javascript
export const metadata = {
  title: 'Page Title',
  description: 'Description'
}

export default function Page() {
  return <div>Content</div>
}
```

**Ưu điểm của Next.js approach:**

- Code sạch hơn, tách biệt concerns
- Type-safe với TypeScript
- Tự động optimize và merge metadata
- Dễ quản lý và bảo trì
- Convention-based, ít boilerplate code


### Metadata Hierarchy

**Thứ tự ưu tiên:**

1. Page metadata (cao nhất)
2. Layout metadata (cấp hiện tại)
3. Parent layout metadata
4. Root layout metadata (thấp nhất)

**Ví dụ cấu trúc:**

```javascript
// app/layout.js (root)
export const metadata = {
  title: {
    template: '%s | Site Name',
    default: 'Site Name'
  },
  description: 'Default description'
}

// app/blog/layout.js
export const metadata = {
  title: {
    template: '%s | Blog'
  }
}

// app/blog/post/page.js
export const metadata = {
  title: 'My Post'
}
// Kết quả: "My Post | Blog"
// Không dùng template từ root layout
```


### Best Practices

**Nên làm:**

- Luôn có title và description ở root layout
- Sử dụng template cho consistency
- Override metadata cho từng page khi cần
- Dùng icon.png với transparent background
- Viết description ngắn gọn, súc tích (150-160 ký tự)

**Không nên:**

- Thêm trực tiếp thẻ vào HTML head
- Dùng title quá dài (> 60 ký tự)
- Bỏ qua description (quan trọng cho SEO)
- Quên thêm favicon
- Hardcode title thay vì dùng template


### Các Thuộc Tính Metadata Khác

Next.js metadata API hỗ trợ nhiều thuộc tính khác ngoài title và description:

```javascript
export const metadata = {
  title: 'Page Title',
  description: 'Page description',
  keywords: ['nextjs', 'react', 'javascript'],
  authors: [{ name: 'Your Name' }],
  openGraph: {
    title: 'OG Title',
    description: 'OG Description',
    images: ['/og-image.jpg']
  },
  twitter: {
    card: 'summary_large_image',
    title: 'Twitter Title',
    images: ['/twitter-image.jpg']
  }
}
```

**Ghi chú:** Các thuộc tính này sẽ được học chi tiết trong các phần sau khi cần thiết.

***

**Liên kết:** [[Next.js]], [[Metadata]], [[SEO]], [[Favicon]], [[HTML Head]], [[Title Template]], [[Open Graph]], [[Layout]], [[Convention]], [[Type Safety]]

