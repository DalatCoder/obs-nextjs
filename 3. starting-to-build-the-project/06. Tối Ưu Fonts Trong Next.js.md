## Tối Ưu Fonts Trong Next.js

### Tầm Quan Trọng Của Fonts

Fonts là một phần quan trọng trong việc xây dựng website. Next.js cung cấp các tính năng tối ưu hóa hiệu suất (performance optimization) cho fonts ngay từ đầu.

**Vấn đề với Google Fonts truyền thống:**

- Font được tải từ server của Google, ảnh hưởng hiệu suất
- Gây ra layout shifts (thay đổi bố cục) khi font đang tải
- Vi phạm quyền riêng tư (privacy) và có thể vi phạm GDPR
- Tốc độ tải chậm hơn so với self-hosting

**Giải pháp của Next.js:**

- Tự động self-host bất kỳ Google font nào
- Font không được tải từ Google nữa
- Cải thiện performance, privacy và ngăn layout shifts
- File fonts được lưu trên server riêng, tải nhanh hơn


### Import Google Fonts

**Bước 1: Import font cần sử dụng**

```javascript
// app/layout.js
import { Josefin_Sans } from 'next/font/google'
```

**Lưu ý cú pháp:**

- Tên font có nhiều từ phải dùng dấu gạch dưới `_`
- Ví dụ: "Josefin Sans" → `Josefin_Sans`
- Import từ package `next/font/google`

**Các nguồn font được hỗ trợ:**

- Google Fonts: `next/font/google`
- Local fonts: `next/font/local` (fonts từ máy tính)


### Cấu Hình Font

**Bước 2: Gọi hàm import và cấu hình**

```javascript
import { Josefin_Sans } from 'next/font/google'

const josefin = Josefin_Sans({
  subsets: ['latin'],
  display: 'swap'
})
```

**Các tùy chọn cấu hình:**

**subsets (bộ ký tự):**

- Xác định tập hợp các ký tự được tải
- Thường dùng: `['latin']` cho tiếng Anh
- Có thể chọn: `'greek'`, `'cyrillic'`, `'chinese'`, v.v.
- Giảm kích thước file bằng cách chỉ tải ký tự cần thiết

**display (chiến lược hiển thị):**

- `'swap'`: Hiển thị text bằng font mặc định trước, sau đó thay thế khi font đã tải xong
- Ngăn chặn FOIT (Flash of Invisible Text)
- Cải thiện trải nghiệm người dùng

**weight (độ đậm font):**

- Không cần thiết với variable fonts (fonts có độ đậm thay đổi)
- Phải chỉ định nếu font không phải variable
- Ví dụ: `weight: ['400', '700']`

```javascript
// Ví dụ với font không phải variable
const roboto = Roboto({
  subsets: ['latin'],
  weight: ['400', '700'],
  display: 'swap'
})
```


### Áp Dụng Font Vào Ứng Dụng

**Bước 3: Sử dụng className được tạo ra**

```javascript
import { Josefin_Sans } from 'next/font/google'

const josefin = Josefin_Sans({
  subsets: ['latin'],
  display: 'swap'
})

export default function RootLayout({ children }) {
  return (
    <html>
      <body className={josefin.className}>
        {children}
      </body>
    </html>
  )
}
```

**Cách hoạt động:**

- Gọi hàm font trả về object chứa `className`
- `className` là class CSS được Next.js tự động tạo
- Class này tham chiếu đến file font được self-host
- Thêm className vào element để áp dụng font

**Kiểm tra output:**

- Console.log object font để xem cấu trúc
- Output xuất hiện ở terminal (server component)
- Chứa className được generate bởi Next.js

```javascript
console.log(josefin)
// Output: { className: '__className_xxxx', style: {...} }
```


### Áp Dụng Font Cho Element Cụ Thể

**Font cho toàn bộ ứng dụng:**

```javascript
<body className={josefin.className}>
  {children}
</body>
```

**Font chỉ cho headings:**

```javascript
const headingFont = Playfair_Display({
  subsets: ['latin'],
  display: 'swap'
})

function Component() {
  return (
    <div>
      <h1 className={headingFont.className}>Heading</h1>
      <p>Regular text with default font</p>
    </div>
  )
}
```

**Kết hợp nhiều fonts:**

```javascript
const bodyFont = Josefin_Sans({ subsets: ['latin'] })
const headingFont = Playfair_Display({ subsets: ['latin'] })

export default function Layout({ children }) {
  return (
    <html>
      <body className={bodyFont.className}>
        <h1 className={headingFont.className}>Title</h1>
        {children}
      </body>
    </html>
  )
}
```


### Local Fonts

**Sử dụng font từ máy tính:**

```javascript
import localFont from 'next/font/local'

const customFont = localFont({
  src: './fonts/custom-font.woff2',
  display: 'swap'
})

export default function Layout({ children }) {
  return (
    <html>
      <body className={customFont.className}>
        {children}
      </body>
    </html>
  )
}
```

**Cấu trúc thư mục:**

```
app/
  fonts/
    custom-font.woff2
  layout.js
```

**Multiple font files:**

```javascript
const customFont = localFont({
  src: [
    {
      path: './fonts/custom-regular.woff2',
      weight: '400',
      style: 'normal'
    },
    {
      path: './fonts/custom-bold.woff2',
      weight: '700',
      style: 'normal'
    }
  ],
  display: 'swap'
})
```


### Variable Fonts

**Khái niệm:** Variable fonts (fonts có độ đậm thay đổi) là fonts chứa nhiều style weights trong một file.

**Lợi ích:**

- Giảm số lượng file cần tải
- Cải thiện performance
- Linh hoạt hơn trong styling
- Hầu hết fonts hiện đại đều là variable fonts

**Ví dụ:**

```javascript
// Variable font - không cần chỉ định weight
const inter = Inter({
  subsets: ['latin'],
  display: 'swap'
})

// Non-variable font - phải chỉ định weight
const roboto = Roboto({
  subsets: ['latin'],
  weight: ['400', '700'],
  display: 'swap'
})
```


### Display Strategies

**Các giá trị của display:**

**swap (khuyến khích):**

- Hiển thị text ngay bằng fallback font
- Swap sang custom font khi đã tải xong
- Tránh invisible text
- Tốt nhất cho UX

**optional:**

- Font chỉ được dùng nếu đã có trong cache
- Nếu chưa cache, dùng fallback font
- Tốt cho performance nhất

**block:**

- Ẩn text cho đến khi font tải xong
- Có thể gây FOIT (Flash of Invisible Text)
- Không khuyến khích

**fallback:**

- Hiển thị fallback font trong thời gian ngắn
- Nếu font không tải kịp, tiếp tục dùng fallback
- Cân bằng giữa performance và UX


### Ba Bước Tóm Tắt

**1. Import font function:**

```javascript
import { Josefin_Sans } from 'next/font/google'
```

**2. Cấu hình font:**

```javascript
const josefin = Josefin_Sans({
  subsets: ['latin'],
  display: 'swap'
})
```

**3. Áp dụng className:**

```javascript
<body className={josefin.className}>
  {children}
</body>
```


### Lợi Ích Của Next.js Font Optimization

**Performance:**

- Fonts được self-host, tải từ server riêng
- Giảm thời gian tải
- Tối ưu file size
- Tự động preload fonts

**Privacy:**

- Không gửi request đến Google servers
- Tuân thủ GDPR
- Bảo vệ thông tin người dùng

**User Experience:**

- Ngăn layout shifts
- Font swapping mượt mà
- Text hiển thị ngay lập tức (với display: swap)
- Không có flash of unstyled text

**Developer Experience:**

- Cấu hình đơn giản chỉ với 3 bước
- Type-safe với TypeScript
- Tự động tối ưu
- Hỗ trợ cả Google fonts và local fonts


### Best Practices

**Nên làm:**

- Luôn dùng `display: 'swap'` cho UX tốt
- Chỉ tải subsets cần thiết để giảm file size
- Ưu tiên variable fonts nếu có thể
- Áp dụng font ở level cao nhất (body hoặc html)
- Preload fonts quan trọng

**Không nên:**

- Tải quá nhiều fonts (ảnh hưởng performance)
- Bỏ qua subset configuration
- Dùng display: 'block' (gây FOIT)
- Import fonts không sử dụng
- Quên optimize font weights


### Ví Dụ Thực Tế

**Multiple fonts strategy:**

```javascript
import { Josefin_Sans, Playfair_Display } from 'next/font/google'

const bodyFont = Josefin_Sans({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-body'
})

const headingFont = Playfair_Display({
  subsets: ['latin'],
  display: 'swap',
  variable: '--font-heading'
})

export default function RootLayout({ children }) {
  return (
    <html>
      <body className={`${bodyFont.className} ${headingFont.className}`}>
        {children}
      </body>
    </html>
  )
}
```

**Sử dụng CSS variables:**

```css
h1, h2, h3 {
  font-family: var(--font-heading);
}

body {
  font-family: var(--font-body);
}
```


***

**Liên kết:** [[Next.js]], [[Google Fonts]], [[Performance Optimization]], [[Self-hosting]], [[GDPR]], [[Layout Shifts]], [[Variable Fonts]], [[CSS]], [[Typography]], [[Web Vitals]], [[Privacy]]

