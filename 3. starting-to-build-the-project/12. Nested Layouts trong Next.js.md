## Nested Layouts trong Next.js

### Khái Niệm Nested Layouts

**Nested layout** (layout lồng nhau) cho phép tạo layout riêng biệt chỉ áp dụng cho một phần cụ thể của website, không phải toàn bộ site. Ví dụ: tạo side navigation chỉ xuất hiện trong account area.

**Phạm vi áp dụng:**

- `/account` - trang dashboard
- `/account/reservations` - trang đặt phòng
- `/account/profile` - trang hồ sơ

Layout này không xuất hiện ở các routes khác như `/cabins` hay `/about`.

### Root Layout vs Nested Layout

**Root Layout:**

- File `layout.js` ở thư mục `app` (top level)
- Áp dụng cho toàn bộ website
- Chứa các elements chung: header, footer, navigation chính

**Nested Layout:**

- File `layout.js` ở trong folder con (ví dụ: `account/layout.js`)
- Chỉ áp dụng cho routes trong folder đó và các nested routes
- Chứa elements riêng cho phần đó của site


### Cách Tạo Nested Layout

**Bước 1: Tạo layout.js trong folder account**

```javascript
// account/layout.js
export default function Layout({ children }) {
  return (
    <div className="grid grid-cols-[16rem_1fr] h-full gap-12">
      <SideNavigation />
      {children}
    </div>
  )
}
```

**Cấu trúc folder:**

```
app/
  layout.js              → Root layout (toàn site)
  account/
    layout.js            → Nested layout (chỉ account area)
    page.js              → /account
    reservations/
      page.js            → /account/reservations
    profile/
      page.js            → /account/profile
```


### Children Prop - Cơ Chế Hoạt Động

**Children prop** là React prop đặc biệt chứa nội dung của page hiện tại:

- Khi ở `/account` → children là nội dung từ `account/page.js`
- Khi ở `/account/reservations` → children là nội dung từ `account/reservations/page.js`
- Khi ở `/account/profile` → children là nội dung từ `account/profile/page.js`

**Ví dụ minh họa:**

```javascript
export default function Layout({ children }) {
  return (
    <div className="grid grid-cols-[16rem_1fr] h-full gap-12">
      {/* Navigation luôn hiển thị */}
      <SideNavigation />
      
      {/* Content thay đổi theo page */}
      {children}
    </div>
  )
}
```


### Thiết Lập Grid Layout

**Grid 2 cột với Tailwind CSS:**

```javascript
<div className="grid grid-cols-[16rem_1fr] h-full gap-12 w-full">
  {/* Cột 1: 16rem cố định cho sidebar */}
  <SideNavigation />
  
  {/* Cột 2: 1fr chiếm phần còn lại */}
  {children}
</div>
```

**Giải thích các classes:**

- `grid` - tạo grid container
- `grid-cols-[16rem_1fr]` - cột 1 rộng 16rem, cột 2 chiếm remaining space
- `h-full` - chiều cao 100% của parent
- `gap-12` - khoảng cách giữa các columns
- `w-full` - chiều rộng 100%


### Dynamic Navigation Component

**Kỹ thuật tạo navigation động:**

```javascript
const navLinks = [
  {
    name: 'Reservations',
    href: '/account/reservations',
    icon: CalendarDaysIcon,
  },
  {
    name: 'Profile',
    href: '/account/profile',
    icon: UserIcon,
  },
]

export default function SideNavigation() {
  return (
    <nav>
      <ul>
        {navLinks.map((link) => (
          <li key={link.name}>
            <Link href={link.href}>
              <link.icon />
              <span>{link.name}</span>
            </Link>
          </li>
        ))}
      </ul>
    </nav>
  )
}
```

**Lợi ích:**

- Dễ thêm/xóa navigation items
- Code gọn gàng và maintainable
- Icons từ heroicons package
- Không cần hard-code từng link


### Import và Setup Components

**Import cần thiết:**

```javascript
import Link from 'next/link'
import SideNavigation from '@/app/_components/SideNavigation'
import SignOutButton from '@/app/_components/SignOutButton'
```

```
**Lưu ý:** Đảm bảo chuyển `<a>` tags thành Next.js `<Link>` component để có client-side navigation.
```


### Metadata cho Nested Pages

Mỗi page cần export metadata riêng để có title chính xác:

**account/profile/page.js:**

```javascript
export const metadata = {
  title: 'Update profile',
}

export default function Profile() {
  return <div>Profile content</div>
}
```

**account/reservations/page.js:**

```javascript
export const metadata = {
  title: 'Reservations',
}

export default function Reservations() {
  return <div>Reservations content</div>
}
```

Nếu không export metadata, page sẽ sử dụng title mặc định từ root layout.

### Điều Chỉnh Root Layout

Để nested layout hoạt động đúng với full height, cần điều chỉnh root layout:

**app/layout.js:**

```javascript
export default function RootLayout({ children }) {
  return (
    <html>
      <body className="grid h-screen">
        <Header />
        
        <div className="w-full">
          {children}
        </div>
      </body>
    </html>
  )
}
```

**Giải thích:**

- `grid` trên body làm cho child div chiếm remaining vertical space
- `h-screen` đảm bảo body cao bằng viewport
- `w-full` trên container đảm bảo chiều rộng đầy đủ


### Troubleshooting Tips

**Khi nested layout không hoạt động đúng:**

1. **Kiểm tra vị trí file layout.js** - Phải ở đúng folder level
2. **Verify children prop** - Đảm bảo đã nhận và render {children}
3. **Check file naming** - Phải là `layout.js` chính xác, không phải `Layout.js`
4. **Thử nghiệm vị trí** - Di chuyển layout.js lên/xuống các levels khác nhau

**Với nested structures sâu (3-4 levels):**

- Có thể khó xác định vị trí đúng cho layout.js
- Thử nghiệm với các vị trí khác nhau trong file tree
- Visualize folder structure để hiểu rõ hơn


### Lợi Ích của Nested Layouts

**Tổ chức code tốt hơn:**

- Tách biệt layout logic cho từng phần của site
- Dễ maintain và update
- Reusable cho các sections tương tự

**Performance:**

- Chỉ render layout cần thiết cho mỗi section
- Không duplicate layout code

**User Experience:**

- Navigation nhất quán trong từng section
- Layout transitions mượt mà
- Không reload toàn trang khi di chuyển giữa nested routes


### Ví Dụ Hoàn Chỉnh

**account/layout.js:**

```javascript
import SideNavigation from '@/app/_components/SideNavigation'

export default function Layout({ children }) {
  return (
    <div className="grid grid-cols-[16rem_1fr] h-full gap-12 w-full px-8 py-12">
      <SideNavigation />
      
      <div className="py-1">
        {children}
      </div>
    </div>
  )
}
```

**_components/SideNavigation.js:**

```javascript
import Link from 'next/link'
import { CalendarDaysIcon, HomeIcon, UserIcon } from '@heroicons/react/24/solid'
import SignOutButton from './SignOutButton'

const navLinks = [
  {
    name: 'Home',
    href: '/account',
    icon: HomeIcon,
  },
  {
    name: 'Reservations',
    href: '/account/reservations',
    icon: CalendarDaysIcon,
  },
  {
    name: 'Guest profile',
    href: '/account/profile',
    icon: UserIcon,
  },
]

export default function SideNavigation() {
  return (
    <nav className="border-r border-primary-900">
      <ul className="flex flex-col gap-2 h-full text-lg">
        {navLinks.map((link) => (
          <li key={link.name}>
            <Link 
              className="py-3 px-5 hover:bg-primary-900 hover:text-primary-100 transition-colors flex items-center gap-4 font-semibold text-primary-200"
              href={link.href}
            >
              <link.icon className="h-5 w-5 text-primary-600" />
              <span>{link.name}</span>
            </Link>
          </li>
        ))}
        
        <li className="mt-auto">
          <SignOutButton />
        </li>
      </ul>
    </nav>
  )
}
```


### Ghi Chú Thêm

- Có thể tạo nhiều nested layouts ở các levels khác nhau
- Mỗi folder level có thể có layout.js riêng
- Layouts cascade (xếp tầng) từ root xuống nested levels
- Children prop tự động được Next.js inject vào
- Layout file không cần export metadata
- SignOutButton sẽ được implement khi làm authentication

**Kết thúc section:** Đã hoàn thành việc setup website structure. Section tiếp theo sẽ focus vào working with data - phần core của web development.

**Liên kết:** [[Next.js]], [[Nested Layouts]], [[Layout.js]], [[Children Prop]], [[File System Routing]], [[Grid Layout]], [[Side Navigation]], [[Dynamic Navigation]], [[Metadata]], [[Root Layout]], [[Tailwind CSS]], [[Link Component]], [[Heroicons]], [[React Props]], [[Component Organization]]

